language: ruby

git:
  submodules: false

env:
  global:
  - AWS_DEFAULT_REGION=us-east-1
  - MESSAGEBROKERNODEINSTANCETYPE=t2.small
  
before_install:
  - echo "Installing AWS CLI"
  - pip install --upgrade --user awscli
  - echo "Installing test gems"
  - gem install yaml-lint
  
install: true

script:
  - 'if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then echo "Cancelling for Pull Requests because secrets are not supported!"; travis_terminate 0; fi'
  - aws cloudformation validate-template --template-body file://templates/.tnguage: ruby

git:
  submodules: false

env:
  global:
  - AWS_DEFAULT_REGION=eu-west-2
  - MESSAGEBROKERNODEINSTANCETYPE=t2.small
  
before_install:
  - echo "Installing AWS CLI"
  - pip install --upgrade --user awscli
  - echo "Installing test gems"
  - gem install yaml-lint
  
install: true

script:
  - aws cloudformation validate-template --template-body file://templates/ApiProxy.template
  - aws cloudformation validate-template --template-body file://templates/proxy_endpoint.template
  - aws cloudformation validate-template --template-body file://templates/proxy_role.template
  - aws cloudformation validate-template --template-body file://templates/proxy_securityGroup.template
  - aws cloudformation validate-template --template-body file://templates/Services/kinesis_proxy.template
  - aws cloudformation validate-template --template-body file://templates/Services/resource_proxy.template
  - aws cloudformation validate-template --template-body file://templates/Services/s3_proxy.template
  - yaml-lint -n templates/
  - yaml-lint -n templates/Services

after_success:
  - echo "Test Success - Branch($TRAVIS_BRANCH) Pull Request($TRAVIS_PULL_REQUEST) Tag($TRAVIS_TAG)"
  - echo "Cloudformation templates validated"
  - echo "YAML linted"
  - echo "Cloudformation tested"
  - echo "Messaging tested"
  - if [ "$TRAVIS_BRANCH" = "master" ]; then aws s3 sync . s3://solace-labs/solace-aws-service-integration/latest --acl public-read; fi


after_script:
